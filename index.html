<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo-Tiles</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="login.css">
</head>

<body class="text-focus-in">
    <div class="container d-flex justify-content-center align-items-center flex-column"
        style="height:100vh;">
        <div class="row">
            <div class="col col-md-12 text-center text-light fs-1 p-4 ">
                <b> Welcome to Photo Tiles</b>
            </div>
        </div>

        <div class="row d-flex justify-content-center">

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary  col col-md-9 p-2 m-2 text-center" data-bs-toggle="modal"
                data-bs-target="#adminModal">
                Enter as an Admin
            </button>

            <!-- Modal -->
            <div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="adminModalLabel">Admin Login</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="contact" class="container my-5">
                                <div class="row justify-content-center ">
                                    <div class="col-lg-6">
                                        <form>

                                            <div class="form-floating my-4">
                                                <input type="email" name="Email" id="loginemail"
                                                    placeholder="e.g; email@gmail.com" class="form-control" required>
                                                <label for="email">Email:</label>
                                            </div>

                                            <div class="form-floating my-4">
                                                <input type="password" name="Password" id="loginpassword"
                                                    placeholder="e.g; 8 characters minimum" class="form-control" required>
                                                <label for="password">Password:</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                Don't have an account?
                                <button type="button" class="btn btn-primary" data-bs-target="#exampleModalToggle2"
                                data-bs-toggle="modal">Sign Up</button>

                                <button type="submit" class="btn btn-primary" id="login">Login</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel"
                tabindex="-1">
                
            </div>
                
            <div class="modal fade" id="exampleModalToggle2" aria-hidden="true"
                aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Admin Sign Up</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="contact" class="container my-5">
                                <div class="row justify-content-center ">
                                    <div class="col-lg-6">
                                        <form>
                                            <div class="form-floating my-4">
                                                <input type="text" name="Username" id="username"
                                                    placeholder="e.g; 8 characters minimum" class="form-control" required>
                                                <label for="username">Username:</label>
                                            </div>

                                            <div class="form-floating my-4">
                                                <input type="email" name="Email" id="email"
                                                    placeholder="e.g; email@gmail.com" class="form-control" required>
                                                <label for="email">Email:</label>
                                            </div>

                                            <div class="form-floating my-4">
                                                <input type="password" name="Password" id="password"
                                                    placeholder="e.g; 6 characters minimum" class="form-control" required>
                                                <label for="password">Password:</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-bs-target="#adminModal"
                                data-bs-toggle="modal">Back to Login</button>
                             <button type="button" class="btn btn-primary" id="signup">Sign Up</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <button class="btn btn-primary col col-md-4 p-3 m-4 text-center" data-bs-target="#exampleModalToggle"
                data-bs-toggle="modal">Enter as an User</button> -->


        </div>
    </div>

</body>
    <script type="module">
            // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBGxPO4pN2qegI9XRs-BF-fYtDhM8H5FVQ",
      authDomain: "phototiles-db.firebaseapp.com",
      databaseURL: "https://phototiles-db-default-rtdb.firebaseio.com",
      projectId: "phototiles-db",
      storageBucket: "phototiles-db.appspot.com",
      messagingSenderId: "956027944112",
      appId: "1:956027944112:web:57b49dbb47973f658a0f75",
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();

    // document.addEventListener('DOMContentLoaded', function() {
    // const signup = document.getElementById('signup');
    // const login = document.getElementById('login');
  
    signup.addEventListener("click", (e) => {
        e.preventDefault()
        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        var username = document.getElementById('username').value;
  
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed up
          const user = userCredential.user;
  
          set(ref(database, 'admins/' + user.uid),{
            username: username,
            email: email
          })
          .then(() => {
          alert("Admin Signed Up!");
          // Redirect to dashboard.html
          window.location.href = "dashboard.html";
        })
      })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          if (errorCode === 'auth/invalid-email') {
            alert("Invalid email format. Please provide a valid email address.");
        } else {
            alert(errorMessage);
        }
          // ..
        });
    });
  
    login.addEventListener("click", (e) => {
      e.preventDefault();
      var email = document.getElementById('loginemail').value;
      var password = document.getElementById('loginpassword').value;
  
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed in 
          const user = userCredential.user;
          const dt = new Date();
          update(ref(database, 'admins/' + user.uid), {
            last_login: dt,
          })
        .then(() => {
          alert("Admin Logged In!");
          // Redirect to dashboard.html
          window.location.href = "dashboard.html";
        })
      })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          if (errorCode === 'auth/invalid-email') {
            alert("Invalid email format. Please provide a valid email address.");
        } else {
            alert(errorMessage);
        }
        });
    });
    
    const user = auth.currentUser;
    onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is signed in, see docs for a list of available properties
      // https://firebase.google.com/docs/reference/js/auth.user
      const uid = user.uid;
      // ...
    } else {
      // User is signed out
      // ...
    }
  });
  
  const logout = document.getElementById('logout');login
  logout.addEventListener("click", (e) => {
    e.preventDefault();
    signOut(auth).then(() => {
    // Sign-out successful.
        alert("Log Out Successfully!");
        // Redirect to dashboard.html
        window.location.href = "index.html";
  }).catch((error) => {
    // An error happened.
           const errorCode = error.code;
          const errorMessage = error.message;
          alert(errorMessage);
  });
    });

// });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
  </script>
</html>